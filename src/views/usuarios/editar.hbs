<!DOCTYPE html>
<html lang="es">

{{>headerId}}

<body>
  <style>
    .btn {
      border-radius: 8px;
    }

    .fa-trash:hover {
      color: red;
    }

    #mensajeErrorRol,
    #mensajeErrorCorreo,
    #mensajeErrorPassword,
    #mensajeErrorNombre,
    #mensajeErrorApellido,
    #mensajeErrorDocumento,
    #mensajeErrorTelefono {
      display: none;
      color: red;
      margin-top: 5px;
    }

    #mensajeErrorRol .icono,
    #mensajeErrorCorreo .icono,
    #mensajeErrorPassword .icono,
    #mensajeErrorNombre .icono,
    #mensajeErrorApellido .icono,
    #mensajeErrorDocumento .icono,
    #mensajeErrorTelefono .icono {
      display: inline-block;
      vertical-align: middle;
      margin-right: 5px;
      width: 15px;
      height: 15px;
    }
  </style>

  <!--Barra de navegación-->
  {{>barId}}
  <!--Barra de navegación-->

  {{#each usuario}}
  <form action="/usuarios_editar/{{idAccess}}" method="post" onsubmit="return validarEnvio()" id="FormEditarUsuario">
    <div class="container" style="margin-top: 60px; margin-bottom: 50px; margin-left:20%;">
      <!--Start Card&Form-->
      <div class="card" style="width: 50%; border-radius: 0; ">
        <div class="card-body">
          {{/each}}
          <!--Start Card #1-->

          <h4 class="card-title" style="margin-bottom: 2%;">Editar usuario</h4>

          <div class="row">
            <div class="col-6">
              <!--Input Rol-->
              <label class="form-label" for="idRol">Rol</label>
              <select class="form-control form-control-sm" style="border-radius: 0;" id="idRol" name="idRol">
                {{#each roles}}
                {{#if seleccionado}}
                <option value="{{idRoles}}" selected>{{nombreRoles}}</option>
                {{else}}
                <option value="{{idRoles}}">{{nombreRoles}}</option>
                {{/if}}
                {{/each}}
              </select>
              <div id="mensajeErrorRol"></div>
              <!--End Input Rol-->

              {{#each usuario}}

              <!--Input Correo-->
              <label class="form-label mt-2" for="correo">Correo</label>
              <input type="email" class="form-control form-control-sm" style="border-radius: 0;" id="correo"
                name="correo" oninput="val_correo()" autocomplete="off" value="{{correo}}">
              <div id="mensajeErrorCorreo"></div>
              <!--End Input Correo-->

              <!--Input Estado-->
              <label class="form-label mt-2" for="estado">Estado</label>
              <select class="form-control form-control-sm" style="border-radius: 0;" id="estado" name="estado">
                {{#if estado1}}
                <option value="A" selected>Activo</option>
                <option value="I">Inactivo</option>
                {{else}}
                <option value="A">Activo</option>
                <option value="I" selected>Inactivo</option>
                {{/if}}
              </select>
              <div id="mensajeErrorEstado"></div>
              <!--End Input Estado-->


              <!--Input Password
              <label class="form-label mt-2" for="password">Contraseña</label>
              <input type="password" class="form-control form-control-sm" style="border-radius: 0;" id="password"
                name="password" oninput="val_password()" autocomplete="off" value="{{passsword}}">
              <div id="mensajeErrorPassword"></div>
              <p>
                <button class="btn btn-primary mt-2" type="button" data-toggle="collapse" data-target="#collapseExample"
                  aria-expanded="false" aria-controls="collapseExample">
                  ingresar nueva contraseña
                </button>
              </p>
              <div class="collapse" id="collapseExample">
                <div class="card card-body">
                  <label class="form-label" for="password">Contraseña</label>
                  <input type="password" class="form-control form-control-sm" style="border-radius: 0;" id="password"
                    name="password" oninput="val_password()" autocomplete="off" value="">
                  <div id="mensajeErrorPassword"></div>
                </div>
              </div>-->
              <!--End Input Password-->

              {{/each}}

            </div>
            <div class="col-6">

              {{#each info}}

              <!--Input Documento-->
              <label class="form-label" for="documento">Documento</label>
              <input type="number" class="form-control form-control-sm" style="border-radius: 0;" id="documento"
                name="documento" oninput="val_documento()" autocomplete="off" value="{{documento}}">
              <div id="mensajeErrorDocumento"></div>
              <!--End Input Documento-->

              <!--Input Nombre-->
              <label class="form-label mt-2" for="nombre">Nombre</label>
              <input type="text" class="form-control form-control-sm" style="border-radius: 0;" id="nombre"
                name="nombre" oninput="val_nombre()" autocomplete="off" value="{{nombre}}">
              <div id="mensajeErrorNombre"></div>
              <!--End Input Nombre-->

              <!--Input Apellido-->
              <label class="form-label mt-2" for="apellido">Apellido</label>
              <input type="text" class="form-control form-control-sm" style="border-radius: 0;" id="apellido"
                name="apellido" oninput="val_apellido()" autocomplete="off" value="{{apellido}}">
              <div id="mensajeErrorApellido"></div>
              <!--End Input Apellido-->

              <!--Input Telefono-->
              <label class="form-label mt-2" for="telefono">Teléfono</label>
              <input type="number" class="form-control form-control-sm" style="border-radius: 0;" id="telefono"
                name="telefono" oninput="val_telefono()" autocomplete="off" value="{{telefono}}">
              <div id="mensajeErrorTelefono"></div>
              <!--End Input Telefono-->
            </div>


          </div>

          <div class="alert alert-info alert-dismissible fade show mt-2" role="alert">
            Si quieres <strong>cambiar la contraseña</strong> debes recuperarla en el <strong>inicio de sesión</strong>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          {{/each}}


          <!--Start Btn R&C-->
          <div style="text-align: right;">
            <div class="mt-3">
              <!--Start Btn Cancelar-->
              <a class="btn btn-danger btn-sm" href="/usuarios" style="margin-top: 1px;" type="button">Cancelar</a>
              <!--End Btn Cancelar-->
              <!--Start Btn Registrar--> <!--data-bs-toggle="modal" data-bs-target="#creacion"-->
              <button type="submit" class="btn btn-success btn-sm" style="margin-bottom: 1px;" id="btnRegistrar">
                Guardar cambios</button>
              <!--End Btn Regiastrar-->
            </div>

          </div>
          <!--End Btn R&C-->

          <!--End Card #1-->

        </div>
      </div>
      <!--End Card&Form-->

    </div>
  </form>
  <br>
  </div>


  <datalist id="data_lis_correos">
    {{#each usuarios}}
    <option value="{{correo}}">
      {{/each}}
  </datalist>

  <datalist id="data_lis_documentos">
    {{#each infos}}
    <option value="{{documento}}">
      {{/each}}
  </datalist>

  <datalist id="data_lis_telefonos">
    {{#each infos}}
    <option value="{{telefono}}">
      {{/each}}
  </datalist>



  <script>
    lastValueC = "";
    function val_correo() {
      var correo = document.getElementById("correo");
      var password = document.getElementById("password");
      var nombre = document.getElementById("nombre");
      var apellido = document.getElementById("apellido");
      var documento = document.getElementById("documento");
      var telefono = document.getElementById("telefono");

      var selectedOptionP = document.querySelector('#data_lis_correos option[value="' + correo.value + '"]');
      if (selectedOptionP) {
        var correoValue = selectedOptionP.getAttribute('correo');
        correo.value = selectedOptionP.value; // Establecer el valor del campo "nombre" como el valor de la opción del datalist
        lastValueC = correoValue; // Actualizar lastValue con el valor del usuario

        password.disabled = true;
        nombre.disabled = true;
        apellido.disabled = true;
        telefono.disabled = true;
        documento.disabled = true;
        mensajeErrorCorreo.innerHTML = '<span class="icono fa fa-circle-xmark"></span>Ya existe un usuario registrado con este correo';
        mensajeErrorCorreo.style.display = 'block';

      } else {
        password.disabled = false;
        nombre.disabled = false;
        apellido.disabled = false;
        telefono.disabled = false;
        documento.disabled = false;
        mensajeErrorCorreo.innerHTML = '';
        mensajeErrorCorreo.style.display = 'none';
      }
    }

    lastValueD = "";
    function val_documento() {
      var documento = document.getElementById("documento");
      var password = document.getElementById("password");
      var nombre = document.getElementById("nombre");
      var apellido = document.getElementById("apellido");
      var correo = document.getElementById("correo");
      var telefono = document.getElementById("telefono");

      var selectedOptionD = document.querySelector('#data_lis_documentos option[value="' + documento.value + '"]');
      if (selectedOptionD) {
        var documentoValue = selectedOptionD.getAttribute('documento');
        documento.value = selectedOptionD.value; // Establecer el valor del campo "nombre" como el valor de la opción del datalist
        lastValueD = documentoValue; // Actualizar lastValue con el valor del usuario

        password.disabled = true;
        nombre.disabled = true;
        apellido.disabled = true;
        telefono.disabled = true;
        correo.disabled = true;
        mensajeErrorDocumento.innerHTML = '<span class="icono fa fa-circle-xmark"></span>Ya existe un usuario registrado con este documento';
        mensajeErrorDocumento.style.display = 'block';

      } else {
        password.disabled = false;
        nombre.disabled = false;
        apellido.disabled = false;
        telefono.disabled = false;
        correo.disabled = false;
        mensajeErrorDocumento.innerHTML = '';
        mensajeErrorDocumento.style.display = 'none';
      }
    }

    lastValueT = "";
    function val_telefono() {
      var telefono = document.getElementById("telefono");
      var password = document.getElementById("password");
      var nombre = document.getElementById("nombre");
      var apellido = document.getElementById("apellido");
      var documento = document.getElementById("documento");
      var correo = document.getElementById("correo");

      var selectedOptionT = document.querySelector('#data_lis_telefonos option[value="' + telefono.value + '"]');
      if (selectedOptionT) {
        var telefonoValue = selectedOptionT.getAttribute('telefono');
        telefono.value = selectedOptionT.value; // Establecer el valor del campo "nombre" como el valor de la opción del datalist
        lastValueT = telefonoValue; // Actualizar lastValue con el valor del usuario

        password.disabled = true;
        nombre.disabled = true;
        apellido.disabled = true;
        correo.disabled = true;
        documento.disabled = true;
        mensajeErrorTelefono.innerHTML = '<span class="icono fa fa-circle-xmark"></span>Ya existe un usuario registrado con este telefono';
        mensajeErrorTelefono.style.display = 'block';

      } else {
        password.disabled = false;
        nombre.disabled = false;
        apellido.disabled = false;
        correo.disabled = false;
        documento.disabled = false;
        mensajeErrorTelefono.innerHTML = '';
        mensajeErrorTelefono.style.display = 'none';
      }
    }

    function val_password() {
      var password = document.getElementById("password");

      if (password.value != "") {
        mensajeErrorPassword.innerHTML = '';
        mensajeErrorPassword.style.display = 'none';
      }
    }

    function val_nombre() {
      var nombre = document.getElementById("nombre");

      if (nombre.value != "") {
        mensajeErrorNombre.innerHTML = '';
        mensajeErrorNombre.style.display = 'none';
      }
    }

    function val_apellido() {
      var apellido = document.getElementById("apellido");

      if (apellido.value != "") {
        mensajeErrorApellido.innerHTML = '';
        mensajeErrorApellido.style.display = 'none';
      }
    }
  </script>

  <!--Validar Envio-->
  <script>
    function validarCampos() {
      var correo = document.getElementById("correo");
      var password = document.getElementById("password");
      var telefono = document.getElementById("telefono");
      var nombre = document.getElementById("nombre");
      var apellido = document.getElementById("apellido");
      var documento = document.getElementById("documento");

      if (correo.value == "") {
        mensajeErrorCorreo.innerHTML = '<span class="icono fa fa-circle-xmark"></span>El correo es un campo obligatorio';
        mensajeErrorCorreo.style.display = 'block';
      }

      /*if (password.value == "") {
        mensajeErrorPassword.innerHTML = '<span class="icono fa fa-circle-xmark"></span>La contraseña es un campo obligatorio';
        mensajeErrorPassword.style.display = 'block';
      }*/

      if (documento.value == "") {
        mensajeErrorDocumento.innerHTML = '<span class="icono fa fa-circle-xmark"></span>El documento es un campo obligatorio';
        mensajeErrorDocumento.style.display = 'block';
      }

      if (nombre.value == "") {
        mensajeErrorNombre.innerHTML = '<span class="icono fa fa-circle-xmark"></span>El nombre es un campo obligatorio';
        mensajeErrorNombre.style.display = 'block';
      }

      if (apellido.value == "") {
        mensajeErrorApellido.innerHTML = '<span class="icono fa fa-circle-xmark"></span>El apellido es un campo obligatorio';
        mensajeErrorApellido.style.display = 'block';
      }

      if (telefono.value == "") {
        mensajeErrorTelefono.innerHTML = '<span class="icono fa fa-circle-xmark"></span>El teléfono es un campo obligatorio';
        mensajeErrorTelefono.style.display = 'block';
      }

    }

    function validarEnvio() {
      var correo = document.getElementById("correo");
      var password = document.getElementById("password");
      var rol = document.getElementById("idRol");
      var telefono = document.getElementById("telefono");
      var nombre = document.getElementById("nombre");
      var apellido = document.getElementById("apellido");
      var documento = document.getElementById("documento");

      if (correo.value == ""/* || password.value == "" */ || rol.value == "" || nombre.value == "" || apellido.value == "" || documento.value == "" || telefono.value == "") {

        //alert('campos obligatorios');
        Swal.fire({
          position: 'top-end',
          icon: 'warning',
          title: 'Campos Obligatorios',
          showConfirmButton: false,
          timer: 1500
        });
        validarCampos();
        return false; // Detener el envío del formulario
      }

      if (password.disabled == true) {
        //alert('campos obligatorios');
        Swal.fire({
          position: 'top-end',
          icon: 'warning',
          title: 'Datos no válidos',
          showConfirmButton: false,
          timer: 1500
        });
        return false; // Detener el envío del formulario
      }

      // Permite el envío del formulario
      return true;
    }
  </script>
  <!--End Validar Envio-->



  <!--Inicio footer-->

  <!--Fin footer-->
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="/assets/js/ValidacionInsumo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
  <!--   Core JS Files   -->
  <script src="/assets/js/core/jquery.min.js"></script>
  <script src="/assets/js/core/popper.min.js"></script>
  <script src="/assets/js/core/bootstrap.min.js"></script>
  <script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!--  Google Maps Plugin    -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
  <!-- Chart JS -->
  <script src="/assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/assets/js/now-ui-dashboard.min.js?v=1.5.0" type="text/javascript"></script>


  <script>
    //SOLO NUMEROS
    $(function () {
      $(".validar").keydown(function (event) {
        //alert(event.keyCode);
        if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105) && event.keyCode !== 190 && event.keyCode !== 110 && event.keyCode !== 8 && event.keyCode !== 9) {
          return false;
        }
      });
    });
  </script>