<!doctype html>
<html lang="es">

{{>headerId}}

<style>
    .btn-participantes:hover,
    .btn-insumos:hover,
    .icon-collapse:hover {
        color: gray;
    }

    #descripcion_R,
    #observacion_R {
        border-radius: 0;
        border: 1px rgb(206, 212, 218) solid;
        line-height: 1.5;
        max-height: 500px;
        padding-top: 0;
        height: 70px;
        background-color: white;
    }


    /* Estilos para el popover */
    .custom-popover {
        position: relative;
        max-width: 330px;
        border: 3px gray solid;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bd-violet-bg */
        background-color: white;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bd-violet-bg */
        color: black;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bs-white */
        padding-left: 0;
        padding-right: 0;
        padding-top: 0;
        padding-bottom: 0;
    }

    .custom-popover2 {
        position: relative;
        max-width: 300px;
        border: 3px gray solid;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bd-violet-bg */
        background-color: white;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bd-violet-bg */
        color: black;
        /* Reemplaza esto con el color hexadecimal que corresponda a --bs-white */
        padding-left: 0;
        padding-right: 0;
        padding-top: 0;
        padding-bottom: 0;
    }

    /* Estilos para la flecha del popover */
    .custom-popover::before,
    .custom-popover2::before {
        content: "";
        position: absolute;
        top: 50%;
        left: -16px;
        /* Ubica la flecha justo a la izquierda del popover */
        border-width: 8px;
        border-style: solid;
        border-color: transparent black transparent transparent;
        /* Utiliza el color correspondiente a --bd-violet-bg */
        transform: translateY(-50%);
        border-right-color: gray;
        /* Agrega un borde negro de 1px a la derecha de la flecha */
    }

    p {
        margin-bottom: 1%;
    }

    .btn {
        border-radius: 8px;
    }

    button {
        border-radius: 8px;
        border: 1px gray solid;
    }

    .badge {
        border-radius: 0;
    }

    .fa-dolly:hover {
        color: gray;
    }

    /* Add this style to your existing CSS */
    .table-container {
        max-height: 400px;
        height: auto;
        /* Adjust this value as per your requirement */
        overflow-y: auto;
        position: relative;
        /* Add this to enable positioning of thead */
    }

    /* Add this style to fix thead */
    .table-container table {
        position: relative;
    }

    .table-container thead {
        position: sticky;
        top: 0;
        z-index: 1;
    }
</style>

<!--Barra de navegación-->
{{> barId}}
<!--Barra de navegación-->
<br><br><br>


<a href="/produccion" style="color:black; text-decoration:none; margin-left: 2%"><i
        class="fa fa-arrow-left fa-2x"></i></a>

<div class="row ml-1">
    <div class="col-md-3">
        {{#each producciones}}

        <div class="card mb-3" style="max-width: 100%; border-radius: 0;">
            <div class="card-body">
                <h5 class="card-title">Producción</h5>
                <div class="card-text">
                    <p><b>Encargado:</b>
                        <button type="button" data-bs-toggle="popover" data-bs-trigger="hover" data-bs-html="true"
                            data-bs-custom-class="custom-popover" title="<b>Usuario</b>" data-bs-content="
                            <div class='row'>
                                <div class='col-md-3'>
                                    <img src='https://icons.iconarchive.com/icons/fa-team/fontawesome/512/FontAwesome-User.png' width='100' />
                                </div>
                                <div class='col-md-9'>
                                    <b>Nombre:</b> {{userName}}<br>
                                    <b>Teléfono:</b> {{userTell}}<br>
                                    <b>Correo:</b> {{userEmail}}<br>
                                </div>
                            </div>
                            ">{{userName}}<span class="badge text-bg-secondary"><i class="fas fa-user"
                                    style="color:black"></i></span>
                        </button>
                        <br>
                    </p>
                    <p><b>Producto:</b>
                        <button type="button" data-bs-trigger="hover" data-bs-toggle="popover" data-bs-html="true"
                            data-bs-custom-class="custom-popover" title="<b>Producto orden de producción</b>"
                            data-bs-content="
                            <div class='popover-content'>
                                <div class='row'>
                                    <div class='col-md-4'>
                                        <img src='/assets/img/Productos/{{proImg}}' alt='Imagen del producto'
                                            style='max-width:100%; max-height:100px'> 
                                        <!--<img src='https://icons.iconarchive.com/icons/fa-team/fontawesome/512/FontAwesome-Gift.png' width='100' />-->
                                    </div>
                                    <div class='col-md-8'>
                                        <b>Nombre:</b> {{proName}}<br>
                                        <b>Descripción:</b> {{proDes}}<br>
                                        <b>Precio:</b> {{proPrecio}}<br>
                                        <b>Stock:</b> {{proStock}}
                                    </div>
                                </div>
                            </div>
                            ">{{proName}} <span class="badge text-bg-secondary"><i class="fas fa-gift"
                                    style="color:black"></i></span>
                        </button>
                        <br>
                    </p>
                    <p><b>CantidadProducir: </b>{{cantidad}}<br></p>
                    <p><b>FechaInicio: </b>{{fechaInicio}}<br></p>
                    <p><b>FechaFin: </b>{{fechaFin}}<br></p>
                    <p><b>Estado: </b>
                        {{#if estado1}}
                        <button class="btn btn-primary btn-sm" style="border-radius:20px;" disabled>Iniciado</button>
                        <!--Iniciado-->
                        {{/if}}
                        {{#if estado2}}
                        <button class="btn btn-success btn-sm" style="border-radius:20px;" disabled>En Proceso</button>
                        <!--Proceso-->
                        {{/if}}
                        {{#if estado3}}
                        <button class="btn btn-secondary btn-sm" style="border-radius:20px;" disabled>Terminado</button>
                        <!--Terminado-->
                        {{/if}}
                    </p>
                </div>
            </div>
        </div>
        {{/each}}


        <center>
            <button class="btn-insumos mb-4" type="button" data-toggle="modal" data-target="#Insumos">
                Insumos requeridos <i class="fa-solid fa-dolly"></i>
            </button>
        </center>


        <!--Modal Insumos-->
        <div class="modal fade" id="Insumos" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Insumos requeridos
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table">
                            <thead style="background-color: #282d32; color:white;">
                                <tr style="text-align: center;">
                                    <th class="w-1/4 py-4 ...">#</th>
                                    <th class="w-1/4 py-4 ...">Insumo</th>
                                    <th class="w-1/4 py-4 ...">Cantidad necesaria</th>
                                </tr>
                            </thead>
                            <tbody style="text-align: center;">
                                {{#each d_producto}}
                                <tr>
                                    <td class="py-2 px-6 text-center">{{cont}}</td>
                                    <td class="p-3 text-center">

                                        <button type="button" data-bs-toggle="popover" data-bs-trigger="hover"
                                            data-bs-custom-class="custom-popover2"
                                            data-bs-title="<b>Insumo {{cont}}</b>" data-bs-html="true" data-bs-content="
                                            <div class='row'>
                                                <div class='col-md-4'>
                                                    <img src='https://icons.iconarchive.com/icons/fa-team/fontawesome/512/FontAwesome-Box-Open-icon.png' width='100' />
                                                </div>
                                                <div class='col-md-8'>
                                                    <b>Nombre:</b> {{nombreI}}<br>
                                                    <b>Medida:</b> {{medidaI}}<br>
                                                    <b>Stock:</b> {{cantidadI}}<br>
                                                </div>
                                            </div>
                                        ">{{nombreI}} <i class="fas fa-box-open" style="color: black"></i></button>
                                    </td>
                                    <!--<td class="p-3 text-center">{{cantidad_n}}</td>-->
                                    <td class="p-3 text-center">{{totalN}}</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!--End Modal Insumos-->

    </div>


    <div class="col-md-9">
        <!--Start Card #3-->
        <div class="card" style="width: 98%; border-radius: 0;">
            <div class="card-body">
                <h5 class="card-title">Tareas</h5>
                <!--Start Table-->
                <div class="table-container">
                    <table class="table table-sm">
                        <thead class="table" style="background-color: #282d32; color:white;">
                            <tr style="text-align: center;">
                                <th>#</th>
                                <th>Titulo</th>
                                <th>FechaInicio</th>
                                <th>FechaFin</th>
                                <th>Estado</th>
                                <th>Funciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each d_produccion}}
                            <tr class="clickable-row">
                                <td class="py-3 px-6 text-center">{{cont}}</td>
                                <td class="p-3 text-center">{{titulo}}</td>
                                <td class="p-3 text-center">{{fechaInicio}}</td>
                                <td class="p-3 text-center">{{fechaFin}}</td>
                                {{#if estado1}}
                                <td class="p-3 text-center">
                                    <button class="btn btn-primary btn-sm" disabled>Iniciado</button>
                                </td>
                                {{/if}}
                                {{#if estado2}}
                                <td class="p-3 text-center">
                                    <button class="btn btn-success btn-sm" disabled>En
                                        Proceso</button>
                                </td>
                                {{/if}}
                                {{#if estado3}}
                                <td class="p-3 text-center">
                                    <button class="btn btn-secondary btn-sm" disabled>
                                        Terminado
                                    </button>
                                </td>
                                {{/if}}

                                <td class="p-3 text-center icono">
                                    <a class="expand-button" type="button">
                                        <i class="fa-solid fa-caret-down icon-collapse fa-2x"></i>
                                        <i class="fa-solid fa-caret-up icon-expand fa-2x"
                                            style="display: none; color:gray;"></i>
                                    </a>
                                </td>
                            </tr>

                            <tr class="extra-row" style="display: none;">
                                <td colspan="6">
                                    <div class="card" style="width: 100%; border-radius: 0;">
                                        <div class="card-body">
                                            <!--<h6 class="card-title">DETALLES</h6>-->

                                            <div class="row">
                                                <div class="col-md-9">
                                                    <!--Input Descripción-->
                                                    <label class="form-label mt-1"
                                                        for="descripcion_R">Descripción</label>
                                                    <textarea class="form-control form-control-sm"
                                                        style="border-radius: 0;" id="descripcion_R"
                                                        readonly>{{descripcion}}</textarea>
                                                    <!--End Input Descripción-->
                                                </div>

                                                <div class="col-md-3">
                                                    <center>
                                                        <button type="button" class="btn-participantes btn-sm mt-4"
                                                            data-toggle="modal" data-target="#id{{cont}}">

                                                            <i class="fa fa-users fa-2x"></i> <br>
                                                            <p>Participantes</p>

                                                        </button>
                                                    </center>
                                                </div>

                                            </div>
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <!--Input Observación-->
                                                    <label class="form-label mt-2"
                                                        for="observacion_R">Observaciones</label>
                                                    <textarea class="form-control form-control-sm mb-2"
                                                        style="border-radius: 0;" id="observacion_R"
                                                        readonly>{{observacion}}</textarea>
                                                    <!--End Input Observación-->
                                                </div>

                                                <div class="col-md-4">
                                                    <label class="form-label mt-4"
                                                        for="observacion_R">Última_Actualización</label>
                                                    <input class="form-control form-control-sm"
                                                        style="border-radius: 0;" type="text" value="{{fechaEstado}}"
                                                        readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                <!--End Table-->
                <div class="row">
                    <div class="col-md-5"></div>
                    <div class="col-md-2">
                        <div class="pagination">
                            <button type="button" class="btn btn-outline-secondary btn-sm prev-btn mt-1"><i
                                    class="fa-solid fa-arrow-left"></i></button>
                            <button type="button" class="btn btn-outline-secondary btn-sm next-btn mt-1 ml-1"><i
                                    class="fa-solid fa-arrow-right"></i></button>
                        </div>
                    </div>
                    <div class="col-md-5"></div>
                </div>
            </div>
        </div>
        <!--End Card #3-->
    </div>

</div>

<!--Modal Participantes-->
{{#each d_produccion}}
<div class="modal fade" id="id{{cont}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Participantes tarea #{{cont}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead style="background-color: #282d32; color:white;">
                        <tr style="text-align: center;">
                            <th>#</th>
                            <th>Participante</th>
                        </tr>
                    </thead>
                    <tbody style="text-align: center;">
                        {{#each participes}}
                        <tr>
                            <td>{{this.cont}}</td>
                            <td>
                                <button type="button" data-bs-toggle="popover" data-bs-trigger="hover"
                                    data-bs-custom-class="custom-popover2"
                                    data-bs-title="<b>Participante {{this.cont}}</b>" data-bs-html="true"
                                    data-bs-content="
                                    <div class='row'>
                                        <div class='col-md-4'>
                                            <img src='https://icons.iconarchive.com/icons/fa-team/fontawesome/512/FontAwesome-User-icon.png' width='100' />
                                        </div>
                                        <div class='col-md-8'>
                                            <b>Nombre:</b> {{this.userName}}<br>
                                            <b>Teléfono:</b> {{this.userTell}}<br>
                                            <b>Correo:</b> {{this.userEmail}}<br>
                                        </div>
                                    </div>
                                ">{{this.userName}} <i class="fas fa-user" style="color: black"></i></button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{{/each}}
<!--End Modal-->

<br>

<center>
    <div class="card mb-3" style="max-width: 80%; border-radius: 0;">
        <div class="card-body">
            <div id='calendar' style="max-height: 600px;"></div>
        </div>
    </div>
</center>

<br>
<br>

<center>
    <div class="card mb-3" style="max-width: 95%; border-radius: 0;">
        <div class="card-body">
            <div id='calendar2' style="max-height: 550px;"></div>
        </div>
    </div>
</center>

<br>


<!-- Modal de Bootstrap -->
<div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="eventModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalLabel">Detalles de la tarea</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Aquí puedes mostrar los detalles del evento -->
                <p id="eventDetails"></p>
            </div>
            <!--<div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>-->
        </div>
    </div>
</div>





</body>

<!--Bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Inicializar los popovers
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
    });
</script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
<!--   Core JS Files   -->
<script src="/assets/js/core/jquery.min.js"></script>
<script src="/assets/js/core/popper.min.js"></script>
<script src="/assets/js/core/bootstrap.min.js"></script>
<script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!-- Chart JS -->
<script src="/assets/js/plugins/chartjs.min.js"></script>
<!--  Notifications Plugin    -->
<script src="/assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="/assets/js/now-ui-dashboard.min.js?v=1.5.0" type="text/javascript"></script>



<!--Detalles de los detalles-->

<script>
    // Desplegar detalle del detalle
    document.addEventListener("DOMContentLoaded", function () {
        var expandButtons = document.getElementsByClassName("expand-button");

        for (var i = 0; i < expandButtons.length; i++) {
            expandButtons[i].addEventListener("click", function () {
                var button = this;
                var clickableRow = button.closest(".clickable-row");
                var nextRow = clickableRow.nextElementSibling;

                if (nextRow.classList.contains("extra-row")) {
                    nextRow.style.display = nextRow.style.display === "none" ? "table-row" : "none";

                    var iconCollapse = button.querySelector(".icon-collapse");
                    var iconExpand = button.querySelector(".icon-expand");

                    if (nextRow.style.display === "none") {
                        iconCollapse.style.display = "block";
                        iconExpand.style.display = "none";
                    } else {
                        iconCollapse.style.display = "none";
                        iconExpand.style.display = "block";
                    }
                }
            });
        }
    });




</script>


<script>
    // Cierra el modal cuando se hace clic en el botón de cierre (x) o el botón "Cerrar"
$('.modal .close, .modal button[data-dismiss="modal"]').on('click', function () {
    $('#eventModal').modal('hide');
});



    const itemsPerPage = 5; // Define el número de registros por página
    let currentPage = 1;

    function showPage(page) {
        const rows = document.querySelectorAll('.clickable-row');
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;

        rows.forEach((row, index) => {
            if (index >= startIndex && index < endIndex) {
                row.style.display = 'table-row';
                row.setAttribute('data-visible', 'true');
            } else {
                row.style.display = 'none';
                row.setAttribute('data-visible', 'false');
            }

            // Oculta los elementos <tr> extra
            const extraRow = row.nextElementSibling;
            if (extraRow && extraRow.classList.contains('extra-row')) {
                extraRow.style.display = 'none';
            }
        });
    }


    function updatePagination() {
        const rows = document.querySelectorAll('.clickable-row');
        const totalRows = rows.length;
        const totalPages = Math.ceil(totalRows / itemsPerPage);

        if (currentPage === 1) {
            document.querySelector('.prev-btn').disabled = true;
        } else {
            document.querySelector('.prev-btn').disabled = false;
        }

        if (currentPage === totalPages) {
            document.querySelector('.next-btn').disabled = true;
        } else {
            document.querySelector('.next-btn').disabled = false;
        }
    }

    document.querySelector('.prev-btn').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            showPage(currentPage);
            updatePagination();
        }
    });

    document.querySelector('.next-btn').addEventListener('click', () => {
        const rows = document.querySelectorAll('.clickable-row');
        const totalRows = rows.length;
        const totalPages = Math.ceil(totalRows / itemsPerPage);

        if (currentPage < totalPages) {
            currentPage++;
            showPage(currentPage);
            updatePagination();
        }
    });

    // Mostrar la primera página al cargar la tabla
    showPage(currentPage);
    updatePagination();
</script>

<!--End Detalles de los detalles-->




<!--CALENDARIO-->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendarEl2 = document.getElementById('calendar2');

        // Obtener el JSON de eventosList.eventos utilizando toJson helper
        var eventosJSON = {{{ toJson eventosList.eventos }}};

    var calendar = new FullCalendar.Calendar(calendarEl, {
        timeZone: 'UTC',
        defaultView: 'month', // Vista por defecto: mes
        editable: false,
        locale: 'es', //español
        selectable: false, // Deshabilitamos la selección manual
        buttonText: {
            today: 'Hoy' // Cambiamos el texto del botón "Today" a "Hoy"
        },
        events: eventosJSON, // Asignar la cadena JSON al atributo events
        /* eventClick: function (info) {
             // Cuando se hace clic en un evento, mostrar la modal con los detalles del evento
             $('#eventModal').modal('show');
             // Puedes agregar el contenido del evento a la modal aquí
             // Por ejemplo, si tus eventos tienen un título, puedes hacer algo como:
             document.getElementById('eventDetails').textContent = info.event.title;
         }*/
        eventClick: function (info) {
            // Obtén el evento actual
            var evento = info.event;

            // Accede a los datos adicionales desde event.extendedProps
            var titulo = evento.extendedProps.titulo;
            var descripcion = evento.extendedProps.descripcion;
            var observacion = evento.extendedProps.observacion;
            var fechaInicio = evento.extendedProps.fechaInicio;
            var fechaFin = evento.extendedProps.fechaFin;
            var estado = evento.extendedProps.estado;

            // Construye el contenido completo para la modal
            var modalContent = `
                <p><b>Título:</b> ${titulo}</p>
                <p><b>Descripción:</b> ${descripcion}</p>
                <p><b>Observación:</b> ${observacion}</p>
                <p><b>Fecha Inicio:</b> ${fechaInicio}</p>
                <p><b>Fecha Fin:</b> ${fechaFin}</p>
                <p><b>Estado:</b> ${estado}</p>
            `;

            // Establece el contenido de la modal y muestra la modal
            $('#eventModal .modal-body').html(modalContent);
            $('#eventModal').modal('show');
        }

    });

    var calendar2 = new FullCalendar.Calendar(calendarEl2, {
        timeZone: 'UTC',
        initialView: 'multiMonthYear',
        editable: false,
        locale: 'es', //español
        buttonText: {
            today: 'Hoy' // Cambiamos el texto del botón "Today" a "Hoy"
        },
        //initialDate: '2023-09-01',  Establecemos la fecha inicial 
        events: eventosJSON,
        eventClick: function (info) {
            // Obtén el evento actual
            var evento = info.event;

            // Accede a los datos adicionales desde event.extendedProps
            var titulo = evento.extendedProps.titulo;
            var descripcion = evento.extendedProps.descripcion;
            var observacion = evento.extendedProps.observacion;
            var fechaInicio = evento.extendedProps.fechaInicio;
            var fechaFin = evento.extendedProps.fechaFin;
            var estado = evento.extendedProps.estado;

            // Construye el contenido completo para la modal
            var modalContent = `
                <p><b>Título:</b> ${titulo}</p>
                <p><b>Descripción:</b> ${descripcion}</p>
                <p><b>Observación:</b> ${observacion}</p>
                <p><b>Fecha Inicio:</b> ${fechaInicio}</p>
                <p><b>Fecha Fin:</b> ${fechaFin}</p>
                <p><b>Estado:</b> ${estado}</p>
            `;

            // Establece el contenido de la modal y muestra la modal
            $('#eventModal .modal-body').html(modalContent);
            $('#eventModal').modal('show');
        }
    });

    calendar.render();
    calendar2.render();
        });
</script>

<!--END CALENDARIO-->